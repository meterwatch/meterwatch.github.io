<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Personal Report</title>
  <link rel="shortcut icon" type="image/png" href="assets/images/logos/favicon.png" />
  <link rel="stylesheet" href="assets/css/styles.min.css" />
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="manifest" href="site.webmanifest">
</head>

<body>
  <!--  Body Wrapper -->
  <div class="page-wrapper" id="main-wrapper" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full"
    data-sidebar-position="fixed" data-header-position="fixed">

    <!--  Main wrapper -->
    <div class="body-wrapper">
      <!--  Header Start -->
      <header class="app-header">
        <nav class="navbar navbar-expand-lg navbar-light">
			<ul class="navbar-nav flex-row ms-auto align-items-center justify-content-end">
				<a href="index.html" target="_blank" class="btn btn-primary">New Report</a>
		  
			  </ul>
          <div class="navbar-collapse justify-content-end px-0" id="navbarNav">
            <ul class="navbar-nav flex-row ms-auto align-items-center justify-content-end">
              
        
            </ul>
          </div>
        </nav>
      </header>
      <!--  Header End -->
      <div class="container-fluid">
        <!--  Row 1 -->
        <div class="row">
          <div class="col-lg-4">
            <div class="row">
              <div class="col-lg-12">
                <!-- Yearly Breakup -->
                <div class="card overflow-hidden">
                  <div class="card-body p-4">
					
					<div class='spinner-border ' role='status'><span class='sr-only'></span></div>
                    
					<h5 class="card-title mb-9 fw-semibold">Daily Energy Usage</h5>
                    <div class="row align-items-center">
                      <div class="col-8">
                        <h4 class="fw-semibold mb-3">...Loading...</h4>
                        <div class="d-flex align-items-center mb-3">
                         
                          <!--<p class="lastpurchaseData text-dark me-1 fs-3 mb-0">+9%</p>-->
						  <div class="lastpurchaseData"></div>
                          <!--<p class="fs-3 mb-0">% difference since last purchase</p>-->
                        </div>
                        <div class="d-flex align-items-center">
                          <div class="me-4 token1">
                            <span class="round-8 bg-primary rounded-circle me-2 d-inline-block"></span>
                            
                          </div>
                          <div class="token2 ">
                            <span class="round-8 bg-light-primary rounded-circle me-2 d-inline-block"></span>
                            
                          </div>
                        </div>
                      </div>
                      <div class="col-4">
                        <div class="d-flex justify-content-center">
                         <!-- <div id="breakup"></div>-->
						 <p class="fs-3 mb-0">% difference since last purchase</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-lg-12">
                <!-- Monthly Earnings -->
                <div class="card">
                  <div class="card-body">
                    <div class="row alig n-items-start">
                      <div class="col-8">
					  <div class="tokenTotal"></div>
						

                      </div>
                      <div class="col-4">
                        <div class="d-flex justify-content-end">
                          <div
                            class="text-white bg-secondary rounded-circle p-6 d-flex align-items-center justify-content-center">
                            <i class="ti ti-currency-dollar fs-6"></i>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div id="earning2"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-8 d-flex align-items-strech">
            <div class="card w-100">
              <div class="card-body">
                <div class="d-sm-flex d-block align-items-center justify-content-between mb-9">
                  <div class="mb-3 mb-sm-0">
                    <h5 class="card-title fw-semibold">Units Purchase History</h5>
                  </div>
                 
                </div>
                <div id="chart2"></div>
              </div>
            </div>
          </div>
         
        </div>
        <div class="row">
          <div class="col-lg-4 d-flex align-items-stretch">
            <div class="card w-100">
              <div class="card-body p-4">
                <div class="mb-4">
                  <h5 class="card-title fw-semibold">Recent Transactions</h5>
                </div>
			  	<div class="tokensAmounts">

				</div>
              </div>
            </div>
          </div>
          <div class="col-lg-8 d-flex align-items-stretch tokensTransactions">
            
          </div>
        </div>
       
        <div class="py-6 px-6 text-center">
         
        </div>
      </div>
    </div>
  </div>
  <script src="assets/libs/jquery/dist/jquery.min.js"></script>
  <script src="assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/sidebarmenu.js"></script>
  <script src="assets/js/app.min.js"></script>
  <script src="assets/libs/apexcharts/dist/apexcharts.min.js"></script>
  <script src="assets/libs/simplebar/dist/simplebar.js"></script>
  <script src="assets/js/dashboard.js"></script>
  <script src="assets/js/axios.min.js"></script>
  <script>
		var urlParams = new URLSearchParams(window.location.search);
		var urlParams = new URLSearchParams(window.location.search);
		var myVariable = urlParams.get('variable');
		console.log(myVariable); // Outputs: Hello from File 1

		axios.get('https://tdccheck.onrender.com/zesaData?num1='+myVariable+'&num2=1')
  		.then((response) => {
			console.log(response.data.data.unitsBought1);
			console.log(response.data.unitsBought1);


console.log(response.data.unitsBought5)
console.log(response.data.date5)
console.log(response.data.token_AMOUNT5)


			//console.log(response.status);
			//console.log(response.statusText);
			//console.log(response.headers);
			//console.log(response.config);
			//console.log(response.data.averagedayuse)
	    	//console.log(response.data.date_orignal2dates)
	    	//console.log(response.data.date_orignal3dates)
	    	//console.log(response.data.date_orignal4dates)
	    	//console.log(response.data.date_orignal5dates)

		// Get the spinner element
		var spinner = document.querySelector('.spinner-border');

		// Check if the spinner element exists
		if (spinner) {
    		// Set the display style to 'none' to hide the spinner
    		spinner.style.display = 'none';
		}

		//update last value purchased
    	const elementToUpdate = document.querySelector('h4.fw-semibold.mb-3');
    	// Check if the element exists
    	if (elementToUpdate) {
    		// Update the innerHTML of the element
    		// Update the innerHTML of the element
			let averageUse=response.data.data.averagedayuse 

			let averageUse1= Number(averageUse.toFixed(3));

    		elementToUpdate.innerHTML = "<h4 class='fw-semibold mb-3'>" + averageUse1 + "kWh </h4>"; 
    	} else {
      		console.error('Element not found.');
    	}
    	//update percent since last
		
    	const lastpurchaseData = document.querySelector('.lastpurchaseData');
    	lastpurchaseData.innerHTML = "<p class='lastpurchaseData text-dark me-1 fs-3 mb-0'>"+ response.data.data.unitsBoughtPercentFromlast  +"%</p>"

    	//update token 1
    	const token1 = document.querySelector('.token1');
    	token1.innerHTML = "<span class='round-8 bg-primary rounded-circle me-2 d-inline-block'></span><span class='fs-2'>"+response.data.data.unitsBought1+ " kWh </span>"
    
    	//update token 2
    	const token2 = document.querySelector('.token2');
    	token2.innerHTML = "<span class='round-8 bg-light-primary rounded-circle me-2 d-inline-block'></span><span class='fs-2'>"+response.data.data.unitsBought2+" kWh </span>"
		
		//upadate last  tokens and amounts
		const tokensAmounts = document.querySelector('.tokensAmounts');
		tokensAmounts.innerHTML =
				"<ul class='timeline-widget mb-0 position-relative mb-n5'><li class='timeline-item d-flex position-relative overflow-hidden'><div class='timeline-time text-dark flex-shrink-0 text-end'>"
                  + "Unit Bought" + 
                  "</div><div class='timeline-badge-wrap d-flex flex-column align-items-center'><span class='timeline-badge border-2 border border-primary flex-shrink-0 my-8'></span><span class='timeline-badge-border d-block flex-shrink-0'></span></div><div class='timeline-desc fs-3 text-dark mt-n1'>"
                    + "Zesa Token" +
                  "</div></li><li class='timeline-item d-flex position-relative overflow-hidden'><div class='timeline-time text-dark flex-shrink-0 text-end'>"
                  + response.data.data.unitsBought1 + " Kwh "+
                  "</div><div class='timeline-badge-wrap d-flex flex-column align-items-center'><span class='timeline-badge border-2 border border-info flex-shrink-0 my-8'></span><span class='timeline-badge-border d-block flex-shrink-0'></span></div><div class='timeline-desc fs-3 text-dark mt-n1 fw-semibold'>"
                    +response.data.data.token_orignal1+
                  "</div></li><li class='timeline-item d-flex position-relative overflow-hidden'><div class='timeline-time text-dark flex-shrink-0 text-end'>"
                  + response.data.data.unitsBought2 + " Kwh "+
                  "</div><div class='timeline-badge-wrap d-flex flex-column align-items-center'><span class='timeline-badge border-2 border border-success flex-shrink-0 my-8'></span><span class='timeline-badge-border d-block flex-shrink-0'></span></div><div class='timeline-desc fs-3 text-dark mt-n1'>"
                    +response.data.data.token_orignal2+
                  "</div></li><li class='timeline-item d-flex position-relative overflow-hidden'><div class='timeline-time text-dark flex-shrink-0 text-end'>"
                  + response.data.data.unitsBought3 + " Kwh "+
                  "</div><div class='timeline-badge-wrap d-flex flex-column align-items-center'><span class='timeline-badge border-2 border border-warning flex-shrink-0 my-8'></span><span class='timeline-badge-border d-block flex-shrink-0'></span></div><div class='timeline-desc fs-3 text-dark mt-n1 fw-semibold'>"
                    +response.data.data.token_orignal3+
                  "</div></li><li class='timeline-item d-flex position-relative overflow-hidden'><div class='timeline-time text-dark flex-shrink-0 text-end'>"
                  + response.data.data.unitsBought4 + " Kwh "+
                  "</div><div class='timeline-badge-wrap d-flex flex-column align-items-center'><span class='timeline-badge border-2 border border-danger flex-shrink-0 my-8'></span><span class='timeline-badge-border d-block flex-shrink-0'></span></div><div class='timeline-desc fs-3 text-dark mt-n1 fw-semibold'>"
                    +response.data.data.token_orignal4+
                  "</div></li><li class='timeline-item d-flex position-relative overflow-hidden'><div class='timeline-time text-dark flex-shrink-0 text-end'>"
					+ response.data.data.unitsBought5 + " Kwh "+
				  "</div><div class='timeline-badge-wrap d-flex flex-column align-items-center'><span class='timeline-badge border-2 border border-success flex-shrink-0 my-8'></span></div><div class='timeline-desc fs-3 text-dark mt-n1'>"
					+response.data.data.token_orignal4+
					"</div></li></ul>"

    	//update all transactions

		const tokensTransactions = document.querySelector('.tokensTransactions');
		tokensTransactions.innerHTML =

					"<div class='card-body p-4'><h5 class='card-title fw-semibold mb-4'>Recent Transactions</h5><div class='table-responsive'><table class='table text-nowrap mb-0 align-middle'><thead class='text-dark fs-4'><tr><th class='border-bottom-0'><h6 class='fw-semibold mb-0'>Id</h6></th><th class='border-bottom-0'><h6 class='fw-semibold mb-0'>Date</h6></th><th class='border-bottom-0'><h6 class='fw-semibold mb-0'>Receipt No</h6></th><th class='border-bottom-0'><h6 class='fw-semibold mb-0'>Priority</h6></th><th class='border-bottom-0'><h6 class='fw-semibold mb-0'>Cost</h6></th></tr></thead><tbody><tr><td class='border-bottom-0'><h6 class='fw-semibold mb-0'>1</h6></td><td class='border-bottom-0'><h6 class='fw-semibold mb-1'>"
					+response.data.data.date1+
					"</h6><span class='fw-normal'></span></td><td class='border-bottom-0'><p class='mb-0 fw-normal'>"
					+response.data.data.receipt_NO_orignal1+
					"</p></td><td class='border-bottom-0'><div class='d-flex align-items-center gap-2'><span class='badge bg-primary rounded-3 fw-semibold' >"
					+ response.data.data.unitsBought1 + " Kwh "+
					"</span></div></td><td class='border-bottom-0'><h6 class='fw-semibold mb-0 fs-4'>"
					+"$ZIG "+response.data.data.token_AMOUNT1+
					"</h6></td></tr> <tr><td class='border-bottom-0'><h6 class='fw-semibold mb-0'>2</h6></td><td class='border-bottom-0'><h6 class='fw-semibold mb-1'>"
					+response.data.data.date2+
					"</h6><span class='fw-normal'></span></td><td class='border-bottom-0'><p class='mb-0 fw-normal'>"
					+response.data.data.receipt_NO_orignal2+
					"</p></td><td class='border-bottom-0'><div class='d-flex align-items-center gap-2'><span class='badge bg-primary rounded-3 fw-semibold'>"
					+ response.data.data.unitsBought2 + " Kwh "+
					"</span></div></td><td class='border-bottom-0'><h6 class='fw-semibold mb-0 fs-4'>"
					+"$ZIG "+response.data.data.token_AMOUNT2+
					"</h6></td></tr> <tr><td class='border-bottom-0'><h6 class='fw-semibold mb-0'>3</h6></td><td class='border-bottom-0'><h6 class='fw-semibold mb-1'>"
					+response.data.data.date3+
					"</h6><span class='fw-normal'></span></td><td class='border-bottom-0'><p class='mb-0 fw-normal'>"
					+response.data.data.receipt_NO_orignal3+
					"</p></td><td class='border-bottom-0'><div class='d-flex align-items-center gap-2'><span class='badge bg-primary rounded-3 fw-semibold'>"
					+ response.data.data.unitsBought3 + " Kwh "+
					"</span></div></td><td class='border-bottom-0'><h6 class='fw-semibold mb-0 fs-4'>"
					+"$ZIG "+response.data.data.token_AMOUNT3+
					"</h6></td></tr><tr><td class='border-bottom-0'><h6 class='fw-semibold mb-0'>4</h6></td><td class='border-bottom-0'><h6 class='fw-semibold mb-1'>"
					+response.data.data.date4+
					"</h6><span class='fw-normal'></span></td><td class='border-bottom-0'><p class='mb-0 fw-normal'>"
					+response.data.data.receipt_NO_orignal4+
					"</p></td><td class='border-bottom-0'><div class='d-flex align-items-center gap-2'><span class='badge bg-primary rounded-3 fw-semibold'>"
					+ response.data.data.unitsBought4 + " Kwh "+
					"</span></div></td><td class='border-bottom-0'><h6 class='fw-semibold mb-0 fs-4'>"
					+"$ZIG "+response.data.data.token_AMOUNT4+
					"</h6></td></tr><tr><td class='border-bottom-0'><h6 class='fw-semibold mb-0'>5</h6></td><td class='border-bottom-0'><h6 class='fw-semibold mb-1'>"
					+response.data.data.date5+
					"</h6><span class='fw-normal'></span></td><td class='border-bottom-0'><p class='mb-0 fw-normal'>"
					+response.data.data.receipt_NO_orignal5+
					"</p></td><td class='border-bottom-0'><div class='d-flex align-items-center gap-2'><span class='badge bg-primary rounded-3 fw-semibold'>"
					+ response.data.data.unitsBought5 + " Kwh "+
					"</span></div></td><td class='border-bottom-0'><h6 class='fw-semibold mb-0 fs-4'>"
					+"$ZIG "+response.data.data.token_AMOUNT5+
					"</h6></td></tr></tbody></table></div></div>"

					let TokenTotal=response.data.data.token_AMOUNT1+response.data.data.token_AMOUNT2+response.data.data.token_AMOUNT3+response.data.data.token_AMOUNT4+response.data.data.token_AMOUNT5
					
					//const Nnumber = 170000;
					console.log("token total"+TokenTotal)
					const formattedNumber = (TokenTotal ).toLocaleString('en', {
					minimumFractionDigits: 2,
					maximumFractionDigits: 2
					});
					
					const tokenTotal= document.querySelector('.tokenTotal');
					tokenTotal.innerHTML =
					"<h5 class='card-title mb-9 fw-semibold'> Daily Amount Spent</h5><h4 class='fw-semibold mb-3'>$ZIG "
					+formattedNumber+
					"</h4><div class='d-flex align-items-center pb-1'><spanclass='me-2 rounded-circle bg-light-danger round-20 d-flex align-items-center justify-content-center'><i class='ti ti-arrow-down-right text-danger'></i></span><!--<p class='text-dark me-1 fs-3 mb-0'>+9%</p><p class='fs-3 mb-0'>last year</p>--></div>"
					

		//////
		
		//chart data
		//let unitsChartKwh =[response.data.unitsBought1,response.data.unitsBought2,response.data.unitsBought3,response.data.unitsBought4,response.data.unitsBought5]
    	//let unitsChartDate =[response.data.date1,response.data.date2,response.data.date3,response.data.date4,response.data.date5]
    	//let amountDollars =[response.data.token_AMOUNT1,response.data.token_AMOUNT2,response.data.token_AMOUNT3,response.data.token_AMOUNT4,response.data.token_AMOUNT5]

		let unitsChartKwh =[response.data.data.unitsBought5,response.data.data.unitsBought4,response.data.data.unitsBought3,response.data.data.unitsBought2,response.data.data.unitsBought1]
    	let unitsChartDate =[response.data.data.date5,response.data.data.date4,response.data.data.date3,response.data.data.date2,response.data.data.date1]
    	let amountDollars =[response.data.data.token_AMOUNT5,response.data.data.token_AMOUNT4,response.data.data.token_AMOUNT3,response.data.data.token_AMOUNT2,response.data.data.token_AMOUNT1]

		
			//update chart
			var chart = {
				series: [
				{ name: "Units Bought kWh",
				//data: [355, 390, 300, 350, 390, 180, 355, 390] },
				data: unitsChartKwh },
				
				],
				chart: {
					type: "bar",
					height: 345,
					offsetX: -15,
					toolbar: { show: true },
					foreColor: "#adb0bb",
					fontFamily: 'inherit',
					sparkline: { enabled: false },
				},
				
				colors: ["#c74e20", "#c74e20"],
				
				plotOptions: {
					bar: {
						horizontal: false,
						columnWidth: "35%",
						borderRadius: [6],
						borderRadiusApplication: 'end',
						borderRadiusWhenStacked: 'all'
					},
				},
				markers: { size: 0 },
				dataLabels: {
					enabled: false,
				},
				legend: {
					show: false,
				},


				grid: {
					borderColor: "rgba(0,0,0,0.1)",
					strokeDashArray: 3,
					xaxis: {
						lines: {
						show: false,
						},
					},
				},

				xaxis: {
					type: "category",
					//categories: ["16/08", "17/08", "18/08", "19/08", "20/08", "21/08", "22/08", "23/08"],
					categories: unitsChartDate,
					labels: {
						style: { cssClass: "grey--text lighten-2--text fill-color" },
					},
				},


				yaxis: {
				show: true,
				min: 0,
				
				tickAmount: 4,
				labels: {
					style: {
					cssClass: "grey--text lighten-2--text fill-color",
					},
				},
				},
				stroke: {
				show: true,
				width: 3,
				lineCap: "butt",
				colors: ["transparent"],
				},


				tooltip: { theme: "light" },

				responsive: [
				{
					breakpoint: 600,
					options: {
					plotOptions: {
						bar: {
						borderRadius: 3,
						}
					},
					}
				}
				]


			};

			var chart = new ApexCharts(document.querySelector("#chart2"), chart);
			chart.render();
				//end update chart


			//update sparkline
				var earning = {
					chart: {
						id: "sparkline3",
						type: "area",
						height: 60,
						sparkline: {
						enabled: true,
						},
						group: "sparklines",
						fontFamily: "Plus Jakarta Sans', sans-serif",
						foreColor: "#adb0bb",
					},
					series: [
						{
						name: "ZWL",
						color: "#49BEFF",
						data: amountDollars, 
						//data: [25, 66, 20, 40, 12, 58, 20],
						},
					],
					xaxis: {
					type: "category",
					//categories: ["16/08", "17/08", "18/08", "19/08", "20/08", "21/08", "22/08", "23/08"],
					categories: unitsChartDate,
					labels: {
						style: { cssClass: "grey--text lighten-2--text fill-color" },
					},
				},
				yaxis: {
				show: true,
				min: 0,
				
				
				labels: {
					style: {
					cssClass: "grey--text lighten-2--text fill-color",
					},
				},
				},
					stroke: {
						curve: "smooth",
						width: 2,
					},
					fill: {
						colors: ["#f3feff"],
						type: "solid",
						opacity: 0.05,
					},

					markers: {
						size: 0,
					},
					tooltip: {
						theme: "dark",
						fixed: {
						enabled: true,
						position: "right",
						},
						x: {
						show: true,
						},
					},
				};
				new ApexCharts(document.querySelector("#earning2"), earning).render();

		});

  
  </script>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-GVRPV64YPR"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-GVRPV64YPR');
  </script>
</body>

</html>